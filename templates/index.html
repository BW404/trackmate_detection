<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hand Tracking (Web)</title>
    <style>
        body { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            font-family: Arial, sans-serif; 
            background: #f0f0f0; 
        }
        video, canvas { 
            border: 1px solid black; 
            margin: 10px; 
        }
    </style>
</head>
<body>
    <h2>Hand Tracking (Browser Camera)</h2>
    <video id="video" autoplay playsinline width="320" height="240"></video>
    <canvas id="canvas" width="320" height="240"></canvas>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const socket = io(); // connect to server

        // Throttle settings
        let lastSent = 0;
        const FPS = 10; // send 10 frames per second
        const interval = 1000 / FPS;

        // Access camera
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
            } catch (err) {
                alert('Camera access error: ' + err);
            }
        }

        startCamera();

        // Send frames to server
        const sendFrame = () => {
            const now = Date.now();
            if (now - lastSent >= interval) {
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                const data = canvas.toDataURL('image/jpeg', 0.5); // reduce size
                socket.emit('frame', data);
                lastSent = now;
            }
            requestAnimationFrame(sendFrame);
        };

        sendFrame();

        // Receive processed frame from server
        socket.on('processed_frame', (data) => {
            const img = new Image();
            img.onload = () => ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            img.src = data;
        });
    </script>
</body>
</html>
