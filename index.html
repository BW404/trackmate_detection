<!DOCTYPE html>
<html>
<head>
  <title>Hand Detection</title>
</head>
<body>
  <h2>Hand Detection</h2>
  <video id="video" autoplay playsinline width="320" height="240"></video>
  <canvas id="canvas" width="320" height="240"></canvas>

  <script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const socket = io();

    // Webcam access
    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
      video.srcObject = stream;
    });

    video.addEventListener('play', () => {
      const sendFrame = () => {
        if (video.paused || video.ended) return;

        // Draw frame to canvas
        ctx.drawImage(video, 0, 0, 320, 240);

        // Compress to JPEG for lower bandwidth
        canvas.toBlob(blob => {
          const reader = new FileReader();
          reader.onloadend = () => {
            socket.emit('video_frame', reader.result);
          };
          reader.readAsDataURL(blob);
        }, 'image/jpeg', 0.5);

        setTimeout(sendFrame, 100); // 10 FPS
      };
      sendFrame();
    });

    // Draw landmarks
    socket.on('hand_landmarks', data => {
      ctx.drawImage(video, 0, 0, 320, 240); // redraw video
      ctx.strokeStyle = 'red';
      ctx.lineWidth = 2;

      data.landmarks.forEach(hand => {
        for (let i = 0; i < hand.length; i++) {
          const x = hand[i].x * canvas.width;
          const y = hand[i].y * canvas.height;
          ctx.beginPath();
          ctx.arc(x, y, 4, 0, 2 * Math.PI);
          ctx.fill();
        }
      });
    });
  </script>
</body>
</html>
